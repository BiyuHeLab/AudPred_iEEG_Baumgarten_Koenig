%TJB: New version of sfa_expt3_HisTrack_CompSaveShuffledKval_LoopSubs.m 
%(based on tone_history_CV_shuffle0_loop.m by Jenn).
%Aim: Loops K-value computation for null distribution based on shuffled tone sequence order
%(via sfa_expt3_HisTrack_CompSaveShuffledKval_SLIDE16.m)
%across subjects, baseline conditions, tone durations conditions, sets (odd
%vs. even as train vs. test), and repetitions

%% 0.1) Specify vars, paths, and setup fieldtrip
addpath('/data/gogodisk4/thomas/AuditoryPrediction/iEEG/')
% addpath('//gogo.sb.nyumc.org/data/gogodisk4/thomas/AuditoryPrediction/iEEG/')

sfa_expt4_setVars
paths_sfa_expt4 = sfa_expt4_paths(vars.location);

%Add base dir and own script dir
addpath(genpath(paths_sfa_expt4.BaseDir));
addpath(genpath(paths_sfa_expt4.ScriptsDir));

%% 0.2) Determine subject-specific parameters (whole-recording)
i_sub = 1; %proxy to load subs_PreProcSettings
sub_list = vars.sub_list; %patients
sub = sub_list{i_sub};

sfa_expt4_subjectinfo %load subject info file (var: si)
subs_PreProcSettings = sfa_expt4_subjectPreProcSettings; %load in file with individual preproc infos

plot_poststepFigs = 0;
save_poststepFigs = 0;

subs = si.sub_list;
tonedur_text = {'0.2' '0.4'};
nReps = 100;

for i_sub = 1:length(subs)
    for baseline_correct = 0 %[0 1];
        for i_tonedur = 1:length(tonedur_text)            
            for i_odd = [0 1]
                
            tic
                 sfa_expt4_HisTrack_CompSaveShuffledKval(subs{i_sub}, baseline_correct, i_odd, tonedur_text{i_tonedur}, nReps)
%                 sfa_expt4_HisTrack_CompSaveShuffledKval_GAMMA(subs{i_sub}, baseline_correct, i_odd, tonedur_text{i_tonedur}, nReps)
                
            disp(['done computing SHUFFLEDk in ' sub ' for ' num2str(nReps) 'Reps in ' num2str(toc) ' sec'])
                
            end
        end
    end
end